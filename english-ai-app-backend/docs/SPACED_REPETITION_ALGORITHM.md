# 间隔重复算法 v2.2 (基于学习队列)

本算法旨在通过动态调整单词在“学习队列”中的位置，来实现高效的间隔重复记忆。它放弃了传统基于“时间”的调度，改为一个更灵活、更适合我们应用场景的“单词间隔”模型。

## 1. 核心概念：掌握度分数 (Mastery Score)

- 每个用户对每个单词的掌握情况，我们用一个从 `0` 开始的**掌握度分数** (`masteryScore`) 来表示。
- 这个分数可以上不封顶，但我们会根据它的范围来决定单词的行为。

## 2. 算法逻辑：提交学习结果 (`POST /api/learn/submit`)

当用户在**任何地方**（单词卡片、文章填空等）完成一个单词的学习时，调用此接口。

### 情况 A：用户答对 (`isCorrect: true`)

1.  **提升分数**: `masteryScore` **加 2 分**。
    -   `newMasteryScore = currentMasteryScore + 2`

### 情况 B：用户答错 (`isCorrect: false`)

1.  **降低分数**: `masteryScore` **减 2 分**。
    -   `newMasteryScore = Math.max(0, currentMasteryScore - 2)` (最低不低于 0)。

## 3. 单词在“学习队列”中的行为

单词是否出现在常规的“单词卡片”学习流中，以及它在队列中的位置，完全由它**更新后**的 `masteryScore` 决定。

**单词间隔表 (v2.2)**

| 掌握度分数 (`masteryScore`) | 行为                               | 间隔单词数 (答对后) |
| :-------------------------- | :--------------------------------- | :-------------------- |
| 0 - 3                       | **强化记忆区** (频繁出现)          | 4 个单词后            |
| 4 - 7                       | **巩固区** (中期复习)              | 20 个单词后           |
| 8 - 11                      | **熟练区** (后期复习)              | 50 个单词后           |
| **12+**                     | **短期掌握** (移出常规队列)        | -                     |

**具体逻辑**:
1.  在用户提交学习结果后，我们首先根据答对/答错更新 `masteryScore`。
2.  然后，我们判断**新的** `masteryScore` 属于哪个区间：
    -   **如果新分数 `< 12`**:
        -   根据上表找到对应的“间隔单词数”。
        -   更新队列位置：`newQueuePosition = learningIndex + interval`。
        -   这个单词会继续出现在常规的卡片学习中。
    -   **如果新分数 `>= 12`**:
        -   这个单词被视为“**短期掌握**”。
        -   将它从常规学习队列中**暂时移除**（例如，设置一个特殊的 `status` 字段或一个极大的 `queuePosition`）。
        -   它将只在“文章填空”等高级模式中出现。

## 4. 跨模式联动

- 这个模型的最大优点是**统一了所有学习模式对掌握度的影响**。
- 无论用户是在刷单词卡片，还是在做文章填空，每一次正确的反馈都会让单词的 `masteryScore` **+2**，每一次错误的反馈都会 **-2**。
- 一个在文章中答错的“短期掌握”单词（例如分数从 12 降到 10），会自动掉入“熟练区”，并**重新出现在**常规的单词卡片学习流中，直到它的分数再次达到 12。
